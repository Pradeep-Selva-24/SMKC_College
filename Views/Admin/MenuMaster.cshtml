@model List<College.Models.MenuVM>

@{
    Layout = "_AdminLayout";
}

<h4 class="fw-bold mb-4">Menu Master Configuration</h4>

<div id="msg"></div>

<div class="card shadow-sm">
    <div class="card-body">

        <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle">
                <thead class="table-dark">
                    <tr>
                        <th style="width:60px;">#</th>
                        <th>Menu Name</th>
                        @* <th>Menu Url</th> *@
                        <th style="width:100px;">Order</th>
                        <th style="width:150px;" class="text-center">Enable</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int sno = 1;
                    }

                    @foreach (var parent in Model)
                    {
                        <tr class="table-primary fw-bold">
                            <td>@sno</td>
                            <td>@parent.MenuName</td>
                            @* <td>@parent.MenuUrl</td> *@
                            <td>@parent.Order</td>
                            <td class="text-center">
                                <div class="form-check form-switch d-flex justify-content-center">
                                    <input class="form-check-input menu-toggle"
                                           type="checkbox"
                                           data-id="@parent.Id"
                                           @(parent.Display == "Y" ? "checked" : "") />
                                </div>
                            </td>
                        </tr>

                        sno++;

                        @foreach (var child in parent.Children)
                        {
                            <tr>
                                <td>@sno</td>
                                <td style="padding-left:40px;"> @child.MenuName</td>
                                @* <td>@child.MenuUrl</td> *@
                                <td>@child.Order</td>
                                <td class="text-center">
                                    <div class="form-check form-switch d-flex justify-content-center">
                                        <input class="form-check-input menu-toggle"
                                               type="checkbox"
                                               data-id="@child.Id"
                                               @(child.Display == "Y" ? "checked" : "") />
                                    </div>
                                </td>
                            </tr>
                            sno++;
                        }
                    }
                </tbody>
            </table>
        </div>

    </div>
</div>
<script src="~/js/jquery.min.js"></script>
<script>
    $(document).on("change", ".menu-toggle", function () {

        const id = $(this).data("id");
        const isChecked = $(this).is(":checked");

        // ✅ Convert to "Y"/"N"
        const displayValue = isChecked ? "Y" : "N";

        $.ajax({
            url: "/Admin/ToggleMenu",
            type: "POST",
            data: { id: id, display: displayValue },
            success: function (res) {
                if (res.success) {
                    $("#msg").html(`<div class="alert alert-success">${res.message}</div>`);
                } else {
                    $("#msg").html(`<div class="alert alert-danger">${res.message}</div>`);
                }
            },
            error: function () {
                $("#msg").html(`<div class="alert alert-danger">Server error</div>`);
            }
        });
    });
</script>
